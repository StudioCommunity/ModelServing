name: Score Modern Model Demo
id: 412abbd1-794f-4888-a72f-a16220b9a521
version: 0.0.0.1
category: Machine Learning\Score
description: Buildin Score Module for a set of limited flavors
inputs:
  - name: Trained model
    type: ModelDirectory
    port: true
    description: Trained predictive model
  - name: Dataset
    type: ImageDirectory
    port: True
    description: input data to score
  - name: Append score columns to output
    type: Boolean
    default: true
    description: If checked, append score columns to the result dataset, otherwise only
      return the scores and true labels if available.
outputs:
  - name: Scored dataset
    type: DataFrameDirectory
    description: Dataset with obtained scores
implementation:
  container:
    runConfig:
      baseDockerImage: mcr.microsoft.com/azureml/base-gpu:intelmpi2018.3-cuda10.0-cudnn7-ubuntu16.04
      gpuSupport: true
    conda:
      name: project_environment
      channels:
        - defaults
        # Workaround for Demo
        - pytorch
      dependencies:
        - python=3.6.8
        - conda
        # Workaround for Demo
        - pytorch=1.3.0
        - torchvision=0.4.1
        - pip:
            # Workaround for dataset input
            - azureml-defaults
            - azureml-designer-model==0.1.20191209.4
            - azureml-designer-score==0.1.20191212.1
            - azureml-designer-core==0.0.25
            - cloudpickle
            - PyYAML
            - click
            - pandas
            - pyarrow==0.12.1
            # Workaround for Demo
            - azureml-designer-core[image]==0.0.25.post7964938
            - fire==0.1.3
            - git+https://github.com/StudioCommunity/CustomModules-1.git@master#subdirectory=azureml-custom-module-examples/image-classification
            - --extra-index-url=https://azureml-modules:3nvdtawseij7o2oenxojj35c43i5lu2ucf77pugohh4g5eqn6xnq@msdata.pkgs.visualstudio.com/_packaging/azureml-modules%40Local/pypi/simple/
    command:
      - python
      - -m
      - azureml.designer.score.score.module_invoker
    args:
      - --trained-model
      - inputValue: Trained model
      - --dataset
      - inputValue: Dataset
      - --append-score-columns-to-output
      - inputValue: Append score columns to output
      - --scored-dataset
      - outputPath: Scored dataset
  invoking:
    module: azureml.designer.score.score.builtin_score_module
    class: BuiltinScoreModule
    func: run
